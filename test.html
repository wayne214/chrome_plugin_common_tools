<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrome插件测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .test-btn {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background: #007cff;
            color: white;
            cursor: pointer;
        }
        .test-btn:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #fff;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <h1>🔧 Chrome插件测试页面</h1>
    
    <div class="test-section">
        <h2>插件功能测试</h2>
        <p>这个页面用于测试Chrome插件的各种功能</p>
        
        <button class="test-btn" onclick="testMessage()">测试消息传递</button>
        <button class="test-btn" onclick="testScreenshot()">测试普通截图</button>
        <button class="test-btn" onclick="testAreaScreenshot()">测试区域截图</button>
        <button class="test-btn" onclick="triggerAreaSelection()">触发区域选择</button>
        
        <div id="result" class="result">
            <label for="test-output">测试结果：</label>
            <div id="test-output">测试结果将显示在这里...</div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>测试内容区域</h2>
        <p>这是一些用于截图测试的内容。你可以选择这个区域进行截图测试。</p>
        <div style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4); padding: 30px; color: white; text-align: center; border-radius: 10px; margin: 20px 0;">
            <h3>🎨 彩色测试区域</h3>
            <p>这是一个彩色的测试区域，方便验证截图功能是否正常工作。</p>
        </div>
        
        <div style="background: #2c3e50; color: white; padding: 20px; border-radius: 8px;">
            <h3>📊 深色测试区域</h3>
            <p>深色背景区域，用于测试不同背景下的截图效果。</p>
            <ul>
                <li>测试项目 1</li>
                <li>测试项目 2</li>
                <li>测试项目 3</li>
            </ul>
        </div>
    </div>

    <script>
        function log(message) {
            const result = document.getElementById('test-output');
            const time = new Date().toLocaleTimeString();
            result.innerHTML += `<div><strong>[${time}]</strong> ${message}</div>`;
            result.scrollTop = result.scrollHeight;
            console.log('[TEST]', message);
        }

        function testMessage() {
            log('🔄 测试消息传递...');
            
            chrome.runtime.sendMessage({
                action: 'test'
            }, (response) => {
                if (chrome.runtime.lastError) {
                    log('❌ 消息传递失败: ' + chrome.runtime.lastError.message);
                } else if (response && response.success) {
                    log('✅ 消息传递成功: ' + response.message);
                } else {
                    log('❌ 消息传递异常: ' + JSON.stringify(response));
                }
            });
        }

        function testScreenshot() {
            log('📸 测试普通截图...');
            
            chrome.runtime.sendMessage({
                action: 'takeScreenshot',
                pageInfo: {
                    title: document.title,
                    url: window.location.href
                }
            }, (response) => {
                if (chrome.runtime.lastError) {
                    log('❌ 普通截图失败: ' + chrome.runtime.lastError.message);
                } else if (response && response.success) {
                    log('✅ 普通截图成功');
                } else {
                    log('❌ 普通截图异常: ' + JSON.stringify(response));
                }
            });
        }

        function testAreaScreenshot() {
            log('✂️ 测试区域截图...');
            
            const selection = {
                x: 100,
                y: 100,
                width: 300,
                height: 200,
                devicePixelRatio: window.devicePixelRatio || 1
            };
            
            chrome.runtime.sendMessage({
                action: 'takeAreaScreenshot',
                selection: selection,
                actionType: 'save',
                pageInfo: {
                    title: document.title,
                    url: window.location.href
                }
            }, (response) => {
                if (chrome.runtime.lastError) {
                    log('❌ 区域截图失败: ' + chrome.runtime.lastError.message);
                } else if (response && response.success) {
                    log('✅ 区域截图成功');
                } else {
                    log('❌ 区域截图异常: ' + JSON.stringify(response));
                }
            });
        }

        function triggerAreaSelection() {
            log('✂️ 触发区域选择模式...');
            
            chrome.runtime.sendMessage({
                action: 'startAreaSelection'
            }, (response) => {
                if (chrome.runtime.lastError) {
                    log('❌ 触发区域选择失败: ' + chrome.runtime.lastError.message);
                } else if (response && response.success) {
                    log('✅ 区域选择模式已启动，请在页面上选择区域');
                } else {
                    log('❌ 触发区域选择异常: ' + JSON.stringify(response));
                }
            });
        }

        // 页面加载完成后显示初始信息
        window.addEventListener('load', () => {
            log('📄 测试页面加载完成');
        });
    </script>
</body>
</html>